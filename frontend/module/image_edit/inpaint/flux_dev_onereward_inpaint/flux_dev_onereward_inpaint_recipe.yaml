nodes:
  unet_loader:
    class_type: UNETLoader
    title: "Load FLUX OneReward UNET"
    params:
      unet_name: "flux.1-fill-dev-OneReward-transformer_fp8.safetensors"
      weight_dtype: "default"
  vae_loader:
    class_type: VAELoader
    title: "Load FLUX VAE"
    params:
      vae_name: "ae.safetensors"
  clip_loader:
    class_type: DualCLIPLoader
    title: "Load FLUX Dual CLIP"
    params:
      clip_name1: "clip_l.safetensors"
      clip_name2: "t5xxl_fp8_e4m3fn_scaled.safetensors"
      type: "flux"
      device: "default"
  
  load_composite_image:
    class_type: LoadImage
    title: "Load Image and Mask"

  pos_prompt_encoder:
    class_type: CLIPTextEncode
    title: "CLIP Text Encode (Positive)"
  neg_prompt_encoder:
    class_type: CLIPTextEncode
    title: "CLIP Text Encode (Negative)"

  flux_guidance:
    class_type: FluxGuidance
    title: "FluxGuidance"

  inpaint_conditioner:
    class_type: InpaintModelConditioning
    title: "Inpaint Model Conditioning"
    params:
      noise_mask: true
      
  differential_diffusion:
    class_type: DifferentialDiffusion
    title: "Differential Diffusion"
    params:
      strength: 1.0
  
  ksampler:
    class_type: KSampler
    title: "KSampler"
    params:
      denoise: 1.0

  vae_decode:
    class_type: VAEDecode
    title: "VAE Decode"
  save_image:
    class_type: SaveImage
    title: "Save Image"

connections:
  - from: "unet_loader:0"
    to: "differential_diffusion:model"
    
  - from: "differential_diffusion:0"
    to: "ksampler:model"

  - from: "clip_loader:0"
    to: "pos_prompt_encoder:clip"
  - from: "clip_loader:0"
    to: "neg_prompt_encoder:clip"

  - from: "pos_prompt_encoder:0"
    to: "flux_guidance:conditioning"
  
  - from: "flux_guidance:0"
    to: "inpaint_conditioner:positive"
  - from: "neg_prompt_encoder:0"
    to: "inpaint_conditioner:negative"
  - from: "vae_loader:0"
    to: "inpaint_conditioner:vae"

  - from: "load_composite_image:0"
    to: "inpaint_conditioner:pixels"
  - from: "load_composite_image:1"
    to: "inpaint_conditioner:mask"

  - from: "inpaint_conditioner:0"
    to: "ksampler:positive"
  - from: "inpaint_conditioner:1"
    to: "ksampler:negative"
  - from: "inpaint_conditioner:2"
    to: "ksampler:latent_image"
  
  - from: "ksampler:0"
    to: "vae_decode:samples"
  - from: "vae_loader:0"
    to: "vae_decode:vae"

  - from: "vae_decode:0"
    to: "save_image:images"

dynamic_lora_chains:
  lora_chain:
    template: "LoraLoaderModelOnly"
    start: "unet_loader"
    output_map:
      "0": "model"
    input_map:
      "model": "model"
    end_input_map:
      "model": ["differential_diffusion:model"]

ui_map:
  input_image: "load_composite_image:image"
  
  positive_prompt: "pos_prompt_encoder:text"
  negative_prompt: "neg_prompt_encoder:text"
  guidance: "flux_guidance:guidance"
  
  seed: "ksampler:seed"
  steps: "ksampler:steps"
  cfg: "ksampler:cfg"
  sampler_name: "ksampler:sampler_name"
  scheduler: "ksampler:scheduler"
  
  filename_prefix: "save_image:filename_prefix"