nodes:
  unet_loader:
    class_type: UNETLoader
    title: "Load Diffusion Model"
    params:
      unet_name: "z_image_turbo_bf16.safetensors"
      weight_dtype: "default"
  vae_loader:
    class_type: VAELoader
    title: "Load VAE"
    params:
      vae_name: "ae.safetensors"
  clip_loader:
    class_type: CLIPLoader
    title: "Load CLIP"
    params:
      clip_name: "qwen_3_4b.safetensors"
      type: "lumina2"
      device: "default"
  controlnet_patch_loader:
    class_type: ModelPatchLoader
    title: "Load ControlNet Patch"
    params:
      name: "Z-Image-Turbo-Fun-Controlnet-Union-2.1-8steps.safetensors"
  
  load_composite_image:
    class_type: LoadImage
    title: "Load Image and Mask"
    
  pos_prompt_encoder:
    class_type: CLIPTextEncode
    title: "CLIP Text Encode (Positive)"
  neg_prompt_encoder:
    class_type: CLIPTextEncode
    title: "CLIP Text Encode (Negative)"
    
  zimage_controlnet:
    class_type: ZImageFunControlnet
    title: "ZImageFunControlnet"
    params:
      strength: 1
      
  model_sampler:
    class_type: ModelSamplingAuraFlow
    title: "ModelSamplingAuraFlow"
    params:
      shift: 3.0
      
  vae_encode_inpaint:
    class_type: VAEEncodeForInpaint
    title: "VAE Encode (for Inpainting)"
    params:
      grow_mask_by: 6
      
  ksampler:
    class_type: KSampler
    title: "KSampler"
    params:
      steps: 8
      cfg: 1.0
      sampler_name: "euler"
      scheduler: "simple"
      denoise: 1.0
      
  vae_decode:
    class_type: VAEDecode
    title: "VAE Decode"
    
  save_image:
    class_type: SaveImage
    title: "Save Image"

connections:
  - from: "unet_loader:0"
    to: "zimage_controlnet:model"
  - from: "controlnet_patch_loader:0"
    to: "zimage_controlnet:model_patch"
  - from: "zimage_controlnet:0"
    to: "model_sampler:model"
  - from: "model_sampler:0"
    to: "ksampler:model"

  - from: "vae_loader:0"
    to: "zimage_controlnet:vae"
  - from: "vae_loader:0"
    to: "vae_encode_inpaint:vae"
  - from: "vae_loader:0"
    to: "vae_decode:vae"

  - from: "clip_loader:0"
    to: "pos_prompt_encoder:clip"
  - from: "clip_loader:0"
    to: "neg_prompt_encoder:clip"
  - from: "pos_prompt_encoder:0"
    to: "ksampler:positive"
  - from: "neg_prompt_encoder:0"
    to: "ksampler:negative"

  - from: "load_composite_image:0"
    to: "zimage_controlnet:inpaint_image"
  - from: "load_composite_image:1"
    to: "zimage_controlnet:mask"
  - from: "load_composite_image:0"
    to: "vae_encode_inpaint:pixels"
  - from: "load_composite_image:1"
    to: "vae_encode_inpaint:mask"
  - from: "vae_encode_inpaint:0"
    to: "ksampler:latent_image"
    
  - from: "ksampler:0"
    to: "vae_decode:samples"
  - from: "vae_decode:0"
    to: "save_image:images"

ui_map:
  input_image: "load_composite_image:image"
  positive_prompt: "pos_prompt_encoder:text"
  negative_prompt: "neg_prompt_encoder:text"
  seed: "ksampler:seed"
  filename_prefix: "save_image:filename_prefix"