nodes:
  unet_loader:
    class_type: UNETLoader
    title: "Load UNET"
    params: { unet_name: "wan2.1_t2v_14b_scaled_fp8_e4m3_lightx2v_4step_comfyui.safetensors", weight_dtype: "default" }
  lora_loader_alpha:
    class_type: LoraLoaderModelOnly
    title: "Load LoRA Alpha"
    params: { strength_model: 1.0, lora_name: "wan_alpha_2.1_rgba_lora.safetensors" }
  clip_loader:
    class_type: CLIPLoader
    title: "Load CLIP"
    params: { type: "wan", device: "default", clip_name: "umt5_xxl_fp8_e4m3fn_scaled.safetensors" }
  vae_loader_rgb:
    class_type: VAELoader
    title: "Load RGB VAE"
    params: { vae_name: "wan_alpha_2.1_vae_rgb_channel.safetensors" }
  vae_loader_alpha:
    class_type: VAELoader
    title: "Load Alpha VAE"
    params: { vae_name: "wan_alpha_2.1_vae_alpha_channel.safetensors" }

  pos_prompt:
    class_type: CLIPTextEncode
    title: "CLIP Text Encode (Positive)"
  neg_prompt:
    class_type: CLIPTextEncode
    title: "CLIP Text Encode (Negative)"
  latent_video_gen:
    class_type: EmptyHunyuanLatentVideo
    title: "Empty Latent Video"
    params: { batch_size: 1 }

  model_sampler:
    class_type: ModelSamplingSD3
    params: { shift: 5.0 }
  ksampler:
    class_type: KSampler
    title: "KSampler"
    params:
      steps: 4
      cfg: 1.0
      sampler_name: "uni_pc"
      scheduler: "simple"
      denoise: 1.0

  vae_decode_rgb:
    class_type: VAEDecode
    title: "RGB VAE Decode"
  create_video_rgb:
    class_type: CreateVideo
    params: { fps: 16 }
  save_video_rgb:
    class_type: SaveVideo
    params: { format: "mp4", codec: "h264" }

  vae_decode_alpha:
    class_type: VAEDecode
    title: "Alpha VAE Decode"
  create_video_alpha:
    class_type: CreateVideo
    params: { fps: 16 }
  save_video_alpha:
    class_type: SaveVideo
    params: { format: "mp4", codec: "h264" }

dynamic_lora_model_only_chains:
  loras_model_only:
    template: LoraLoaderModelOnly
    output_map:
      "lora_loader_alpha:0": model
    end_input_map:
      model: "model_sampler:model"

dynamic_easycache_chains:
  use_easy_cache:
    ksampler_node: "ksampler"

connections:
  - from: "unet_loader:0"
    to: "lora_loader_alpha:model"
  - from: "lora_loader_alpha:0"
    to: "model_sampler:model"
  - from: "model_sampler:0"
    to: "ksampler:model"

  - from: "clip_loader:0"
    to: "pos_prompt:clip"
  - from: "clip_loader:0"
    to: "neg_prompt:clip"
  - from: "pos_prompt:0"
    to: "ksampler:positive"
  - from: "neg_prompt:0"
    to: "ksampler:negative"
  - from: "latent_video_gen:0"
    to: "ksampler:latent_image"
    
  - from: "ksampler:0"
    to: "vae_decode_rgb:samples"
  - from: "vae_loader_rgb:0"
    to: "vae_decode_rgb:vae"
  - from: "vae_decode_rgb:0"
    to: "create_video_rgb:images"
  - from: "create_video_rgb:0"
    to: "save_video_rgb:video"
    
  - from: "ksampler:0"
    to: "vae_decode_alpha:samples"
  - from: "vae_loader_alpha:0"
    to: "vae_decode_alpha:vae"
  - from: "vae_decode_alpha:0"
    to: "create_video_alpha:images"
  - from: "create_video_alpha:0"
    to: "save_video_alpha:video"

ui_map:
  positive_prompt: "pos_prompt:text"
  negative_prompt: "neg_prompt:text"
  aspect_ratio:
    width: "latent_video_gen:width"
    height: "latent_video_gen:height"
  video_length: "latent_video_gen:length"
  seed: "ksampler:seed"
  filename_prefix_rgb: "save_video_rgb:filename_prefix"
  filename_prefix_alpha: "save_video_alpha:filename_prefix"