nodes:
  unet_loader:
    class_type: UNETLoader
    title: "Load Diffusion Model"
    params:
      unet_name: "Wan21-WanMove_fp8_scaled_e4m3fn_KJ.safetensors"
      weight_dtype: "default"
  lora_loader:
    class_type: LoraLoaderModelOnly
    title: "LoraLoaderModelOnly"
    params:
      strength_model: 1.0
  clip_loader:
    class_type: CLIPLoader
    title: "Load CLIP"
    params:
      clip_name: "umt5_xxl_fp8_e4m3fn_scaled.safetensors"
      type: "wan"
      device: "default"
  vae_loader:
    class_type: VAELoader
    title: "Load VAE"
    params:
      vae_name: "wan_2.1_vae.safetensors"
  clip_vision_loader:
    class_type: CLIPVisionLoader
    title: "Load CLIP Vision"
    params:
      clip_name: "clip_vision_h.safetensors"
  load_image:
    class_type: LoadImage
    title: "Load Image"
  scale_image:
    class_type: ImageScale
    title: "Upscale Image"
    params:
      upscale_method: "lanczos"
      crop: "center"
  clip_vision_encode:
    class_type: CLIPVisionEncode
    title: "CLIP Vision Encode"
    params:
      crop: "center"
  pos_prompt:
    class_type: CLIPTextEncode
    title: "CLIP Text Encode (Prompt)"
  neg_prompt:
    class_type: CLIPTextEncode
    title: "CLIP Text Encode (Prompt)"
  track_to_video_preprocessor:
    class_type: WanMoveTrackToVideo
    title: "WanMoveTrackToVideo"
  model_sampler:
    class_type: ModelSamplingSD3
    title: "ModelSamplingSD3"
    params:
      shift: 5.0
  ksampler:
    class_type: KSampler
    title: "KSampler"
    params:
      steps: 4
      cfg: 1.0
      sampler_name: "er_sde"
      scheduler: "simple"
      denoise: 1.0
  vae_decode:
    class_type: VAEDecode
    title: "VAE Decode"
  create_video:
    class_type: CreateVideo
    title: "Create Video"
    params:
      fps: 16
  save_video:
    class_type: SaveVideo
    title: "Save Video"
    params:
      format: "auto"
      codec: "auto"
  generate_tracks:
    class_type: GenerateTracks
    title: "GenerateTracks"

dynamic_wan_move_chains:
  wan_move_chain:
    start_node: "generate_tracks"
    end_node: "track_to_video_preprocessor"

dynamic_lora_model_only_chains:
  loras_model_only:
    template: LoraLoaderModelOnly
    output_map:
      "lora_loader:0": model
    end_input_map:
      model: "model_sampler:model"

dynamic_easycache_chains:
  use_easy_cache:
    ksampler_node: "ksampler"

connections:
  - from: "unet_loader:0"
    to: "lora_loader:model"
  - from: "lora_loader:0"
    to: "model_sampler:model"
  - from: "model_sampler:0"
    to: "ksampler:model"
  - from: "clip_loader:0"
    to: "pos_prompt:clip"
  - from: "clip_loader:0"
    to: "neg_prompt:clip"
  - from: "load_image:0"
    to: "scale_image:image"
  - from: "scale_image:0"
    to: "clip_vision_encode:image"
  - from: "clip_vision_loader:0"
    to: "clip_vision_encode:clip_vision"
  - from: "pos_prompt:0"
    to: "track_to_video_preprocessor:positive"
  - from: "neg_prompt:0"
    to: "track_to_video_preprocessor:negative"
  - from: "vae_loader:0"
    to: "track_to_video_preprocessor:vae"
  - from: "scale_image:0"
    to: "track_to_video_preprocessor:start_image"
  - from: "generate_tracks:0"
    to: "track_to_video_preprocessor:tracks"
  - from: "clip_vision_encode:0"
    to: "track_to_video_preprocessor:clip_vision_output"
  - from: "track_to_video_preprocessor:0"
    to: "ksampler:positive"
  - from: "track_to_video_preprocessor:1"
    to: "ksampler:negative"
  - from: "track_to_video_preprocessor:2"
    to: "ksampler:latent_image"
  - from: "ksampler:0"
    to: "vae_decode:samples"
  - from: "vae_loader:0"
    to: "vae_decode:vae"
  - from: "vae_decode:0"
    to: "create_video:images"
  - from: "create_video:0"
    to: "save_video:video"

ui_map:
  input_image: "load_image:image"
  positive_prompt: "pos_prompt:text"
  negative_prompt: "neg_prompt:text"
  
  aspect_ratio:
    width: ["scale_image:width", "generate_tracks:width", "track_to_video_preprocessor:width"]
    height: ["scale_image:height", "generate_tracks:height", "track_to_video_preprocessor:height"]

  num_frames: "generate_tracks:num_frames"
  start_x: "generate_tracks:start_x"
  start_y: "generate_tracks:start_y"
  end_x: "generate_tracks:end_x"
  end_y: "generate_tracks:end_y"
  bezier: "generate_tracks:bezier"
  mid_x: "generate_tracks:mid_x"
  mid_y: "generate_tracks:mid_y"
  interpolation: "generate_tracks:interpolation"
  num_tracks: "generate_tracks:num_tracks"
  track_spread: "generate_tracks:track_spread"

  strength: "track_to_video_preprocessor:strength"
  video_length: "track_to_video_preprocessor:length"

  seed: "ksampler:seed"
  filename_prefix: "save_video:filename_prefix"
  lora_name: "lora_loader:lora_name"